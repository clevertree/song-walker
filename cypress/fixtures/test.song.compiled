(async function rootTrack({loadPreset, wait, playCommand}) {
const track = {...this};
const _tw = wait.bind(track);
const _tp = playCommand.bind(track);
const lead=await loadPreset.bind(track)("FluidR3/AcousticGrandPiano");
const osc=await loadPreset.bind(track)("Oscillator", {'type':'square'});
const perc=await loadPreset.bind(track)("FluidR3/DrumKitRoom1");

track1.bind(track)(lead); beat1.bind(track)(); await _tw(8);
track1.bind(track)(osc); beat1.bind(track)(); await _tw(8);

async function track1(instrument) {
	const track = {...this};
	const _tw = wait.bind(track);
	const _tp = playCommand.bind(track);

    track.instrument = instrument;
    track.duration=1/4
    _tp('C5'); await _tw(1/2);
    track.pitchBend=-0.4
    track.config={var: 'wut'}
    _tp('C4', {duration:1/4,velocity:82}); await _tw(1/2);  // override duration and velocity
    _tp('G4'); await _tw(1/2);
    _tp('Eb4'); await _tw(1/2);
    _tp('Eb5'); await _tw(1/2);
    _tp('F5'); await _tw(1/2);
    _tp('Eb5'); await _tw(1/2);
    _tp('D5'); await _tw(1/2);
    _tp('C5'); await _tw(1/2);
    _tp('C4'); await _tw(1/2);
    _tp('G4'); await _tw(1/2);
    _tp('Eb4'); await _tw(1/2);
    _tp('D5'); await _tw(1/2);
    _tp('C4'); await _tw(1/2);
    _tp('Bb4'); await _tw(1/2);
}

async function beat1() {
	const track = {...this};
	const _tw = wait.bind(track);
	const _tp = playCommand.bind(track);

    track.instrument=perc
    track.velocityDivisor=10
    _tp('chh');     _tp('abd');     await _tw(1/2);
    _tp('chh', {velocity:3});           await _tw(1/2);
    _tp('chh', {velocity:3});           await _tw(1/2);
    _tp('chh');     _tp('as');      await _tw(1/2);
    _tp('chh', {velocity:3,duration:1/8});        await _tw(1/2);
    _tp('chh');     _tp('abd');     await _tw(1/2);
    _tp('chh', {velocity:3});   _tp('abd', {velocity:6});   await _tw(1/2);
    _tp('chh');     _tp('as');      await _tw(1/2);
    _tp('chh', {velocity:3});           await _tw(1/4);
    _tp('chh', {velocity:3});           await _tw(1/4);
    _tp('chh');     _tp('abd');     await _tw(1/2);
    _tp('chh', {velocity:3});           await _tw(1/2);
    _tp('chh');     _tp('as');      await _tw(1/2);
    _tp('chh', {velocity:3});           await _tw(1/2);
    _tp('chh');     _tp('abd');     await _tw(1/2);
    _tp('chh', {velocity:3});   _tp('abd', {velocity:6});   await _tw(1/2);
    _tp('chh');     _tp('as');      await _tw(1/2);
    _tp('ohh', {velocity:3});           await _tw(1/2);
}
})
